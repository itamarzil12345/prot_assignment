version: '3.8'

services:
  scraper:
    build:
      context: .
      dockerfile: services/scraper/Dockerfile
    container_name: protego-scraper
    environment:
      - DATABASE_URL=${DATABASE_URL}
      - SCRAPER_SCHEDULE_CRON=${SCRAPER_SCHEDULE_CRON:-0 2 * * *}
      - SCRAPER_ENABLED=${SCRAPER_ENABLED:-true}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - ENVIRONMENT=${ENVIRONMENT:-development}
    volumes:
      - ./services/scraper/logs:/app/services/scraper/logs
    restart: unless-stopped
    networks:
      - protego-network

  analysis:
    build:
      context: .
      dockerfile: services/analysis/Dockerfile
    container_name: protego-analysis
    environment:
      - DATABASE_URL=${DATABASE_URL}
      - ANALYSIS_ENABLED=${ANALYSIS_ENABLED:-true}
      - ANALYSIS_POLL_INTERVAL_SECONDS=${ANALYSIS_POLL_INTERVAL_SECONDS:-300}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - ENVIRONMENT=${ENVIRONMENT:-development}
    volumes:
      - ./services/analysis/logs:/app/services/analysis/logs
    restart: unless-stopped
    networks:
      - protego-network

  api:
    build:
      context: .
      dockerfile: services/api/Dockerfile
    container_name: protego-api
    ports:
      - "8000:8000"
    environment:
      - DATABASE_URL=${DATABASE_URL}
      - API_HOST=${API_HOST:-0.0.0.0}
      - API_PORT=${API_PORT:-8000}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - ENVIRONMENT=${ENVIRONMENT:-development}
    volumes:
      - ./services/api/logs:/app/services/api/logs
    restart: unless-stopped
    networks:
      - protego-network
    depends_on:
      - scraper
      - analysis

networks:
  protego-network:
    driver: bridge

